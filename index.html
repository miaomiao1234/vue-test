<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale-1.0">
        <title>my-package</title>
    </head>
    <style>
        .active {
            background-color: #ddd;
        }
    </style>
    <body>
        <!-- 宿主文件 -->
        <div id="app">
            <!-- 宿主文件 -->
        <div id="app">
            <h2 :title="title">
                <!-- 用户输入 -->
                {{pack}}
                <p><input v-model="pack" type="text" @keydown.enter="addPack" /></p>
                <button @click="addPack">新增</button>
                <br>
                <!-- 插值文本 -->
                {{title}}
                <!-- 条件渲染 -->
                <p v-if="packages.length == 0">然而并没有</p>
                <!-- 列表渲染 -->
                <div class="pack-list" v-else>
                    <div v-for="c in packages" :key="c" :class="{active: selectedPack === c}" 
                        :style="{backgroundColor: selectedPack === c ? '#ddd' : 'transparent'}"
                        @click="selectedPack = c">
                        <div>{{ c }}</div>
                    </div>
                </div>
                <!-- 物件总数 -->
                <p>
                    <!-- 表达式 -->
                    <!-- 物件总数： {{packages.length + '个'}} -->
                    <!-- {{total}} -->
                    <!-- 监听器 -->
                    {{totalCount}}
                </p>
            </h2>
        </div>
        </div>
        
        <script src="vue.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script> -->
        <script>
            // 模拟异步数据的调用
            function getPackges(params) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        resolve(['糖','sweet 糖'])
                    }, 2000);
                })
            }
            // 1.创建vue 实例
            const app = new Vue({
                el: '#app',
                data() {
                    return {
                        title: '我的裤兜',
                        pack: 'miao',
                        selectedPack: '',
                        totalCount: '',
                        // packages: ['糖','sweet 糖'],
                        packages: []
                    }
                },
                // 组件实例已创建，由于未挂载，dom不存在
                async created () {
                    const packages = await getPackges();
                    this.packages = packages;
                },
                // 组件已挂在，dom 已存在
                // mounted () {
                //     ;
                // },
                methods: {
                    addPack() {
                        // 1. 添加 something 同 packages
                        this.packages.push(this.pack)
                        // 2. 清空 packages
                        this.pack = ''
                    }
                },
                computed: {
                    total() {
                        // 计算属性有缓存性，如果值没有发生变化，则页面不会重新渲染
                        return this.packages.length + '个' 
                    }
                },
                // watch 监听函数页面加载不会立即执行，只有监听的值变化后才会执行
                // watch: {
                //     packages(newValue, oldValue) {
                //         this.totalCount = newValue.length + '个'
                //     }
                // },
                // 添加参数，immediate 是立即执行的选项
                watch: {
                    packages: {
                        immediate: true,
                        deep: true,  // 数据结构比较深时需要添加此选项(目前数组只有一层)
                        handler(newValue, oldValue) {
                            this.totalCount = newValue.length + '个'
                        }
                    }
                },
            })
            setTimeout(() => {
                app.title = '有糖'
            }, 3000)

            console.log(app.$options.render)
        </script>
    </body>
</html>